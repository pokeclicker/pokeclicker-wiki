<div>
    <h2>Types</h2>
    <div class="table-responsive">
        <table class="table table-hover table-striped table-bordered">
            <thead>
                <tr>
                    <th>Vitamin</th>
                    <th>Description</th>
                    <th>Base Price</th>
                    <th>Max Price</th>
                </tr>
            </thead>
            <tbody data-bind="foreach: GameHelper.enumStrings(GameConstants.VitaminType)">
                <tr>
                    <td>
                        <a href="#" data-bind="text: $data, attr: { href: `#!Items/${$data}`}"></a>
                    </td>
                    <td data-bind="html: ItemList[$data].description"></td>
                    <td data-bind="attr: { 'data-order': ItemList[$data].basePrice }">
                        <img data-bind="attr: { src: `./images/${GameConstants.Currency[ItemList[$data].currency]}.svg` }" width="18px"/>
                        <ko data-bind="text: ItemList[$data].basePrice.toLocaleString()"></ko>
                    </td>
                    <td data-bind="attr: { 'data-order': ItemList[$data].basePrice }">
                        <img data-bind="attr: { src: `./images/${GameConstants.Currency[ItemList[$data].currency]}.svg` }" width="18px"/>
                        <ko data-bind="text: (ItemList[$data].basePrice * 100).toLocaleString()"></ko>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
<div>
    <h2 class="mt-3">Vitamins for Maximum Breeding Efficiency</h2>
    <div data-bind="using: GameHelper.enumNumbers(GameConstants.Region).filter(r => r > -1 && r <= GameConstants.MAX_AVAILABLE_REGION)">
        <ul class="nav nav-tabs" role="tablist" data-bind="foreach: $data">
            <li class="nav-item" role="presentation">
                <button class="nav-link" data-bs-toggle="tab" type="button" role="tab"
                    data-bind="text: GameConstants.camelCaseToString(GameConstants.Region[$data]), attr: { id: `tab-${$index()}`, 'data-bs-target': `#tab-${$index()}-pane` }, css: { active: $index() == GameConstants.MAX_AVAILABLE_REGION }"></button>
            </li>
        </ul>
        <div class="tab-content mb-2" data-bind="foreach: $data">
            <div class="tab-pane fade" role="tabpanel" data-bind="attr: { id: `tab-${$index()}-pane` }, css: { show: $index() == GameConstants.MAX_AVAILABLE_REGION, active: $index() == GameConstants.MAX_AVAILABLE_REGION }">
                <h5 class="mt-2" data-bind="text: `In ${GameConstants.camelCaseToString(GameConstants.Region[$data])} you can use up to ${($data + 1)*5} vitamins per Pokémon.`"></h5>
                <table class="table table-hover table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr>
                            <th class="col-1">Id</th>
                            <th class="col-3">Pokémon</th>
                            <th class="col-1 text-center">Protein</th>
                            <th class="col-1 text-center">Calcium</th>
                            <th class="col-1 text-center">Carbos</th>
                            <th class="col-1 text-center">Egg Steps</th>
                            <th class="col-2 text-center">Breeding Efficiency</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- ko foreach: pokemonList.filter(p => p.id > 0 && PokemonHelper.calcNativeRegion(p.name) <= $data) -->
                        <tr>
                            <td data-bind="text: `#${Math.floor($data.id).toString().padStart(3, '0')}`, attr: { 'data-sort': $data.id }"></td>
                            <td data-bind="text: $data.name"></td>
                            <!-- ko using: Wiki.pokemon.getBestVitamins($data.attack, $data.eggCycles, $parent) -->
                            <td class="text-center" data-bind="text: $data.protein"></td>
                            <td class="text-center" data-bind="text: $data.calcium"></td>
                            <td class="text-center" data-bind="text: $data.carbos"></td>
                            <td class="text-center" data-bind="text: $data.eggSteps"></td>
                            <td class="text-center" data-bind="text: $data.eff.toLocaleString('en-US', { maximumSignificantDigits: 3, minimumSignificantDigits: 3 })"></td>
                            <!-- /ko -->
                        </tr>
                        <!-- /ko -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<div>
    <h2>Calculator</h2>
    <div class="table-responsive">
        <table class="table table-hover table-striped table-bordered">
            <thead>
                <tr>
                    <td class="col-2 p-0"></td>
                    <td class="col-2 p-0"></td>
                    <td class="col-2 p-0"></td>
                    <td class="col-2 p-0"></td>
                    <td class="col-2 p-0"></td>
                    <td class="col-2 p-0"></td>
                </tr>
                <tr>
                    <th colspan="3">Base Attack</th>
                    <th colspan="3">Egg Steps</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="p-0" colspan="3"><input class="form-control typeahead me-2 text-dark tt-input" oninput="updateEfficiency()" id="efficiency-calculator-input-attack" value="184" type="number" min="10" step="1" max="1000"/></td>
                    <td class="p-0" colspan="3"><input class="form-control typeahead me-2 text-dark tt-input" oninput="updateEfficiency()" id="efficiency-calculator-input-egg-steps" value="4800" type="number" min="200" step="200" max="10000"/></td>
                </tr>
            </tbody>
            <thead>
                <tr>
                    <th colspan="2">Protein</th>
                    <th colspan="2">Calcium</th>
                    <th colspan="2">Carbos</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="2" class="p-0"><input class="form-control typeahead me-2 text-dark tt-input" oninput="updateEfficiency()" id="efficiency-calculator-input-protein" value="0" type="number" min="0" step="1" max="100"/></td>
                    <td colspan="2" class="p-0"><input class="form-control typeahead me-2 text-dark tt-input" oninput="updateEfficiency()" id="efficiency-calculator-input-calcium" value="0" type="number" min="0" step="1" max="100"/></td>
                    <td colspan="2" class="p-0"><input class="form-control typeahead me-2 text-dark tt-input" oninput="updateEfficiency()" id="efficiency-calculator-input-carbos" value="0" type="number" min="0" step="1" max="100"/></td>
                </tr>
            </tbody>
            <thead>
                <tr>
                    <th colspan="2">Attack per Breed</th>
                    <th colspan="2">Egg Steps Required</th>
                    <th colspan="2">Efficiency</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="2" id="efficiency-calculator-output-attack">46</td>
                    <td colspan="2" id="efficiency-calculator-output-egg-steps">4,800</td>
                    <td colspan="2" id="efficiency-calculator-output-efficiency">0.383</td>
                </tr>
            </tbody>
        </table>
        <script>
            const updateEfficiency = () => {
                const base = 'efficiency-calculator-input-';
                const attack = +document.getElementById(`${base}attack`)?.value || 10;
                const eggCycles = (+document.getElementById(`${base}egg-steps`)?.value || 200) / 40;
                const protein = +document.getElementById(`${base}protein`)?.value || 0;
                const calcium = +document.getElementById(`${base}calcium`)?.value || 0;
                const carbos = +document.getElementById(`${base}carbos`)?.value || 0;

                const attackBonus = Wiki.pokemon.getBreedingAttackBonus([protein, calcium, carbos], attack);
                const eggSteps = Wiki.pokemon.calcEggSteps([protein, calcium, carbos], eggCycles);
                const efficiency = Wiki.pokemon.getEfficiency([protein, calcium, carbos], attack, eggCycles);
                
                const baseOutput = 'efficiency-calculator-input-';
                document.getElementById('efficiency-calculator-output-attack').innerText = attackBonus.toLocaleString();
                document.getElementById('efficiency-calculator-output-egg-steps').innerText = eggSteps.toLocaleString();
                document.getElementById('efficiency-calculator-output-efficiency').innerText = efficiency.toLocaleString('en-US', { maximumFractionDigits: 3 });
            }
            updateEfficiency();
        </script>
    </div>
</div>
